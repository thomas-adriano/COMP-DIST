package com.taxifleet.server.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;

public abstract class TableWatcher implements Runnable {

	private long watchInterval;

	public static final String JDBC_URL = "jdbc:sqlserver://localhost:1433;databaseName=TaxiAdministrator;integratedSecurity=true;";

	public TableWatcher(long watchInterval) {
		this.watchInterval = watchInterval;
	}

	public abstract TableLines getModifyedLines();

	public abstract String getSqlStatement();

	@Override
	public void run() {
		while (true) {
			// Create a variable for the connection string.
			try (Connection con = DriverManager.getConnection(JDBC_URL);
					Statement stmt = con.createStatement();
					ResultSet rs = stmt.executeQuery(getSqlStatement());) {

				// Establish the connection.
				Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");

				// Iterate through the data in the result set and display it.
				while (rs.next()) {

					watch();

				}
			}

			// Handle any errors that may have occurred.
			catch (Exception e) {
				e.printStackTrace();
			}
			try {
				Thread.sleep(watchInterval);
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
	}

	public abstract void watch();

}
